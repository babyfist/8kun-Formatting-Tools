/*
8Chan Formatting Tools
    - Adds a toolbar above the commenting area containing most of 8Chan's formatting options
    - Press esc to close quick-reply window
    - Hover cursor over each button to show availiable shortcut

*/
if(active_page=="thread"||active_page=="index"){var commentToolFormats={bold:{displayText:"B",altText:"bold",styleCSS:"font-weight: bold;",options:{prefix:"'''",suffix:"'''"},edit:function(e,t){wrapSelection(e,t)},shortcutKey:"b"},italics:{displayText:"i",altText:"italics",styleCSS:"font-style: italic;",options:{prefix:"''",suffix:"''"},edit:function(e,t){wrapSelection(e,t)},shortcutKey:"i"},under:{displayText:"U",altText:"underline",styleCSS:"text-decoration: underline;",options:{prefix:"__",suffix:"__"},edit:function(e,t){wrapSelection(e,t)},shortcutKey:"u"},spoiler:{displayText:"spoiler",altText:"mark as spoiler",styleCSS:"",options:{prefix:"[spoiler]",suffix:"[/spoiler]"},edit:function(e,t){wrapSelection(e,t)},shortcutKey:"s"},code:{displayText:"code",altText:"code formatting",styleCSS:'font-family: "Courier New", Courier, monospace;',options:{prefix:"[code]",suffix:"[/code]",multiline:true},edit:function(e,t){wrapSelection(e,t)}},strike:{displayText:"strike",altText:"strikethrough",styleCSS:"text-decoration: line-through;",options:{prefix:"~~",suffix:"~~"},edit:function(e,t){wrapSelection(e,t)}},heading:{displayText:"heading",altText:"redtext",styleCSS:"color: #AF0A0F; font-weight: bold;",options:{prefix:"==",suffix:"==",exclusiveLine:true},edit:function(e,t){wrapSelection(e,t)}}};(function(e,t){"use strict";var n,r,i,s;var o=[];var u="";var a="";for(s in t){if(t.hasOwnProperty(s)&&t[s].displayText!=null){r=t[s].displayText;i=t[s].altText||"";n=t[s].shortcutKey;if(i){if(n){i+=" (ctrl+"+n+")"}i='title="'+i+'"'}u='<a href="javascript:void(0)" '+i+' id="tf-'+s+'">'+r+"</a>";o.push(u)}else{continue}}e('textarea[name="body"]').before('<div class="tf-toolbar"></div>');e(".tf-toolbar").html(o.join(" | "));a="\n/* generated by 8chan Formatting Tools */"+"\n.tf-toolbar {padding: 0px 5px 1px 5px;}"+"\n.tf-toolbar :link {text-decoration: none;}";for(s in t){if(t.hasOwnProperty(s)&&t[s].styleCSS){a+=" \n#tf-"+s+" {"+t[s].styleCSS+"}"}}if(e(".user-css").length!==0){e(".user-css").append(a)}else{e("body").append("<style>"+a+"\n</style>")}e("body").on("keydown",'textarea[name="body"]',{formats:t},function(e){if(e.ctrlKey){var t=String.fromCharCode(e.which).toLowerCase();var n=e.target;var r=e.data.formats;for(var i in r){if(r.hasOwnProperty(i)&&t===r[i].shortcutKey){r[i].edit(n,r[i].options);e.preventDefault()}}}});e("body").on("keydown",'#quick-reply textarea[name="body"]',{formats:t},function(t){if(t.which===27){e(".close-btn").trigger("click")}});e("body").on("keydown",function(e){if(e.target.nodeName!=="TEXTAREA"&&e.target.nodeName!=="INPUT"){if(e.which===67){document.location.href="//"+document.location.host+"/"+board_name+"/catalog.html"}}});e("body").on("click",".tf-toolbar a[id]",{formats:t},function(t){var n=t.data.formats;var r=e(t.target).parent().next()[0];for(var i in n){if(n.hasOwnProperty(i)&&t.target.id==="tf-"+i){n[i].edit(r,n[i].options)}}})})(jQuery,commentToolFormats);var wrapSelection=function(e,t){"use strict";if(e==null){return}var n=t.prefix;var r=t.suffix;var i=t.multiline||false;var s=t.exclusiveLine||false;var o=e.scrollTop;var u=e.selectionStart;var a=e.selectionEnd;var f=e.value;var l=f.substring(0,u);var c=f.substring(u,a);var h=f.substring(a);var p=["\r","\n"];var d="";var v=c.length-1;while(v>0&&c[v]===" "){d+=" ";v--}c=c.substring(0,v+1);if(!i)c=c.replace(/(\r|\n|\r\n)/g,r+"$1"+n);if(s){v=l.length-1;while(v>=0&&p.indexOf(l.charAt(v))==-1){v--}c=l.substring(v+1)+c;l=l.substring(0,v+1);v=0;while(v<h.length&&p.indexOf(h.charAt(v))==-1){v++}c+=h.substring(0,v);h=h.substring(v)}e.value=l+n+c+r+d+h;e.selectionEnd=l.length+n.length+c.length;if(u===a){e.selectionStart=e.selectionEnd}else{e.selectionStart=l.length+n.length}e.scrollTop=o}}